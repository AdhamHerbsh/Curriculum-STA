// ==================================================
// API Interaction Layer
// ==================================================

async function callActualGeminiAPI(promptContent, type) {
  const apiKey = localStorage.getItem('userApiKey'); // Using 'userApiKey' as set in the previous subtask

  if (!apiKey) {
    // Immediately return a Promise that rejects
    return Promise.reject({ 
      error: 'NO_API_KEY', 
      message: 'الرجاء إدخال مفتاح API أولاً في الإعدادات بالأسفل.' 
    });
  }

  console.log('Attempting to call actual Gemini API for type:', type, 'with prompt:', promptContent);

  // Simulate API delay
  await new Promise(resolve => setTimeout(resolve, 1000));

  // Mock responses based on type (reusing logic from old simulateGeminiResponse)
  // Added (API) to responses to distinguish them during testing.
  switch (type) {
    case 'job-description':
      return `
وصف المهنة: أخصائي الإلكترونيات والتصنيع (من API)

نظرة عامة:
يقوم أخصائي الإلكترونيات والتصنيع بتصميم وتطوير وصيانة الأنظمة الإلكترونية والمعدات الصناعية. يجمع هذا التخصص بين المعرفة النظرية في الهندسة الإلكترونية والمهارات العملية في التصنيع والإنتاج.

المسؤوليات الأساسية:
• تصميم وتطوير الدوائر الإلكترونية والأنظمة الرقمية (من API)
• برمجة وتشغيل المعدات الصناعية والروبوتات
• إجراء الصيانة الوقائية والإصلاحية للأجهزة الإلكترونية
• مراقبة جودة الإنتاج وضمان المعايير الفنية
• إعداد التقارير الفنية وتوثيق العمليات

البيئة المهنية:
يعمل في المصانع، ورش التصنيع، مختبرات البحث والتطوير، وشركات الأتمتة الصناعية.

المتطلبات الأساسية:
• درجة في الهندسة الإلكترونية أو تخصص ذات صلة
• خبرة في برمجة المتحكمات الدقيقة
• معرفة بأنظمة التحكم الصناعي
• مهارات حل المشاكل والتفكير التحليلي

فرص التطوير المهني:
مهندس أنظمة، مدير إنتاج، استشاري تقني، أو متخصص في الذكاء الاصطناعي الصناعي.
      `;
      
    case 'activities':
      return `
1. تصميم وتطوير الدوائر الإلكترونية الأساسية والمتقدمة (من API)
2. برمجة المتحكمات الدقيقة وأنظمة التحكم المدمجة
3. تشغيل وصيانة خطوط الإنتاج الآلية
4. إجراء اختبارات الجودة والتحليل الفني للمنتجات
5. تركيب وتكوين أنظمة الأتمتة الصناعية
6. صيانة وإصلاح المعدات الإلكترونية والصناعية
7. تطوير برامج التحكم في العمليات الصناعية
8. مراقبة وتحليل البيانات من أنظمة الإنتاج
9. إعداد التقارير الفنية وتوثيق العمليات
10. تدريب العاملين على استخدام المعدات الجديدة
11. إدارة المشاريع التقنية وتنسيق الفرق
12. تطبيق معايير السلامة والجودة في البيئة الصناعية
13. تحليل الأعطال وإيجاد الحلول التقنية
14. تطوير وتحسين العمليات الصناعية
15. التعامل مع أنظمة الشبكات الصناعية والاتصالات
16. إدارة المخزون التقني والقطع الغيار
17. التخطيط للصيانة الوقائية والدورية
18. تقييم وتحسين كفاءة الطاقة في الأنظمة
      `;
      
    case 'competencies':
      return `
النشاط: تصميم وتطوير الدوائر الإلكترونية الأساسية والمتقدمة (من API)
الجدارات:
- تحليل وتصميم الدوائر الإلكترونية التناظرية والرقمية
- استخدام برامج المحاكاة الإلكترونية والتصميم
- فهم خصائص المكونات الإلكترونية وتطبيقاتها
- تطبيق معايير السلامة في التصميم الإلكتروني

النشاط: برمجة المتحكمات الدقيقة وأنظمة التحكم المدمجة (من API)
الجدارات:
- برمجة المتحكمات الدقيقة بلغات مختلفة
- تصميم وتطوير البرمجيات المدمجة
- فهم معمارية المعالجات والأنظمة المدمجة
- تطبيق بروتوكولات الاتصال في الأنظمة المدمجة

النشاط: تشغيل وصيانة خطوط الإنتاج الآلية (من API)
الجدارات:
- تشغيل وإدارة خطوط الإنتاج الآلية
- تطبيق مبادئ الصيانة الوقائية والإصلاحية
- استخدام أدوات القياس والاختبار الصناعية
- إدارة وتحليل بيانات الإنتاج والأداء
      `;
      
    case 'skills-knowledge':
      return `
المهارات العملية (من API):
- تطبيق قوانين الكهرباء في حل المسائل العملية
- استخدام أجهزة القياس الإلكترونية بدقة
- تجميع وتوصيل الدوائر الإلكترونية
- اختبار وفحص المكونات الإلكترونية
- قراءة وتفسير المخططات التقنية

المعارف النظرية (من API):
- قوانين الكهرباء والمغناطيسية الأساسية
- خصائص أشباه الموصلات والمكونات الإلكترونية
- مبادئ الدوائر التناظرية والرقمية
- معايير السلامة في الأعمال الكهربائية
- رموز ومصطلحات الهندسة الإلكترونية
      `;
      
    default:
      return 'استجابة تجريبية من API';
  }
}
