<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>تصميم إطار مناهج بالذكاء الاصطناعي</title>
    <style>
        /* Reset and basic */
        * {
            box-sizing: border-box;
        }
        body {
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            background: #f0f4f8; /* لون خلفية هادئ */
            color: #333;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
        }
        #app {
            background: #ffffff; /* لون خلفية أبيض */
            border-radius: 12px;
            padding: 30px 40px;
            width: 900px;
            max-width: 95vw;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 1em;
            text-align: center;
            font-size: 1.8rem; /* حجم خط أكبر */
        }
        button {
            background-color: #007bff; /* لون أزرار جذاب */
            border: none;
            color: white;
            padding: 10px 16px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            margin: 6px 8px 6px 0;
            transition: background-color 0.3s ease, transform 0.2s; /* تأثير التحويل */
        }
        button:hover:not(:disabled) {
            background-color: #0056b3; /* لون أغمق عند التحويم */
            transform: translateY(-2px); /* تأثير رفع الزر */
        }
        button:disabled {
            background-color: #a2bce6;
            cursor: default;
        }
        textarea, input[type=text] {
            width: 100%;
            border-radius: 8px;
            border: 1.8px solid #ccc;
            padding: 12px 14px;
            font-size: 15px;
            resize: vertical;
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            transition: border-color 0.3s; /* تأثير تغيير لون الحدود */
        }
        textarea:focus, input[type=text]:focus {
            border-color: #007bff; /* تغيير لون الحدود عند التركيز */
            outline: none; /* إزالة الإطار الافتراضي */
        }
        label {
            font-weight: 600;
            margin-bottom: 6px;
            display: block;
            color: #2c3e50;
        }
        .section {
            margin-bottom: 40px;
        }
        .flex-row {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        .half-width {
            flex: 1 1 45%;
            min-width: 300px;
        }
        .full-width {
            flex: 1 1 100%;
        }
        .inline-radio {
            margin-left: 22px;
            margin-right: 10px;
        }
        .activities-list,
        .competencies-list,
        .skills-list,
        .knowledge-list {
            max-height: 210px;
            overflow-y: auto;
            border: 1.5px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            background: #fefefe;
        }
        .activities-list label,
        .competencies-list label {
            display: block;
            margin-bottom: 5px;
            cursor: pointer;
        }
        .nav-buttons {
            text-align: center;
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 24px;
        }
        .nav-buttons button {
            min-width: 140px;
        }
        .section-title {
            font-size: 1.2rem;
            margin-bottom: 12px;
            border-bottom: 2px solid #007bff; /* لون خط تحت العنوان */
            padding-bottom: 6px;
        }
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff; /* لون دوران اللودر */
            border-radius: 50%;
            width: 18px;
            height: 18px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-left: 10px;
            vertical-align: middle;
        }
        @keyframes spin {
            0% { transform: rotate(0deg);}
            100% { transform: rotate(360deg);}
        }
        pre {
            background: #f8f9fa; /* لون خلفية للـ pre */
            border-radius: 8px;
            padding: 12px;
            white-space: pre-wrap;
            font-size: 14px;
            max-height: 160px;
            overflow-y: auto;
            border: 1px solid #ccc;
        }
        .competency-block, .activity-block {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 14px 18px;
            margin-bottom: 16px;
            background: #f9fafb;
        }
        .subsection-title {
            font-weight: 700;
            margin-top: 14px;
            margin-bottom: 6px;
            color: #1f3c88;
        }
        .inline-buttons {
            margin-top: 6px;
        }
        .inline-buttons button {
            padding: 6px 12px;
            font-size: 14px;
        }
        .small-textarea {
            height: 90px;
        }
        .readonly-field {
            background: #eee;
            padding: 10px;
            border-radius: 8px;
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            white-space: pre-wrap;
            max-height: 140px;
            overflow-y: auto;
        }
        .reference-list {
            font-size: 12px;
            margin-top: 8px;
            color: #555;
        }
    </style>
</head>
<body>
<div id="app">
    <h1>تصميم إطار مناهج بالذكاء الاصطناعي</h1>

    <!-- Step 1: معلومات عامة عن التخصص + وصف المهنة -->
    <section v-show="step === 1" class="section" aria-label="معلومات عامة عن التخصص ووصف المهنة">
        <div class="section-title">أولاً: معلومات عامة عن التخصص ووصف المهنة</div>

        <label for="generalInfo">معلومات عامة عن التخصص (المنظري/المصنع):</label>
        <textarea id="generalInfo" v-model="generalInfo" placeholder="أدخل معلومات عامة عن التخصص هنا..." rows="5"></textarea>

        <div style="margin-top: 16px;">
            <label>وصف المهنة:</label>
            <div>
                <button @click="generateDescription('deepseek')" :disabled="loadingDeepseekDesc">
                    توليد باستخدام DEEPSEEK
                    <span v-if="loadingDeepseekDesc" class="loader"></span>
                </button>
                <button @click="generateDescription('gemini')" :disabled="loadingGeminiDesc">
                    توليد باستخدام GEMINI
                    <span v-if="loadingGeminiDesc" class="loader"></span>
                </button>
                <button @click="clearDescriptions" style="background:#b03c3c;">مسح كل المحتويات</button>
            </div>

            <div class="flex-row" style="margin-top: 16px;">
                <div class="half-width">
                    <label>وصف المهنة من DEEPSEEK:</label>
                    <textarea readonly rows="6" :value="descriptionDeepseek"></textarea>
                </div>
                <div class="half-width">
                    <label>وصف المهنة من GEMINI:</label>
                    <textarea readonly rows="6" :value="descriptionGemini"></textarea>
                </div>
            </div>

            <label style="margin-top: 20px;" for="manualDesc">وصف المهنة يدويًا:</label>
            <textarea id="manualDesc" v-model="descriptionManual" rows="6" placeholder="يمكنك كتابة وصف المهنة يدويًا هنا"></textarea>

            <fieldset style="margin-top: 14px;">
                <legend>اختر الوصف لتأكيده:</legend>
                <label class="inline-radio">
                    <input type="radio" value="manual" v-model="selectedDescription" />
                    الوصف اليدوي
                </label>
                <label class="inline-radio">
                    <input type="radio" value="deepseek" v-model="selectedDescription" :disabled="!descriptionDeepseek" />
                    الوصف DEEPSEEK
                </label>
                <label class="inline-radio">
                    <input type="radio" value="gemini" v-model="selectedDescription" :disabled="!descriptionGemini" />
                    الوصف GEMINI
                </label>
            </fieldset>
        </div>

        <div class="nav-buttons">
            <button @click="goNextStep" :disabled="!canProceedStep1">التالي &raquo;</button>
        </div>
    </section>

    <!-- Step 2: الأنشطة الرئيسية -->
    <section v-show="step === 2" class="section" aria-label="توليد وتحديد الأنشطة الرئيسية">
        <div class="section-title">ثانياً: بناء على وصف المهنة توليد الأنشطة الرئيسية للمهنة</div>

        <div>
            <button @click="generateActivities('deepseek')" :disabled="loadingDeepseekActivities">
                توليد الأنشطة باستخدام DEEPSEEK
                <span v-if="loadingDeepseekActivities" class="loader"></span>
            </button>
            <button @click="generateActivities('gemini')" :disabled="loadingGeminiActivities">
                توليد الأنشطة باستخدام GEMINI
                <span v-if="loadingGeminiActivities" class="loader"></span>
            </button>
            <button @click="clearActivities" style="background:#b03c3c;">مسح كل الأنشطة</button>
        </div>

        <div class="flex-row" style="margin-top: 16px;">
            <div class="half-width">
                <label>الأنشطة من DEEPSEEK:</label>
                <textarea readonly rows="7" :value="activitiesDeepseek.join('\n- ')? '- ' + activitiesDeepseek.join('\n- ') : ''"></textarea>
            </div>
            <div class="half-width">
                <label>الأنشطة من GEMINI:</label>
                <textarea readonly rows="7" :value="activitiesGemini.join('\n- ')? '- ' + activitiesGemini.join('\n- ') : ''"></textarea>
            </div>
        </div>

        <label style="margin-top: 20px;" for="manualActivities">الأنشطة يدوياً (يمكنك كتابة عدة أنشطة، كل نشاط بسطر مختلف):</label>
        <textarea id="manualActivities" v-model="activitiesManualText" rows="6" placeholder="مثل: تصليح الأجهزة - صيانة المعدات"></textarea>

        <div style="margin-top:20px;">
            <label>اختر الأنشطة الرئيسية التي تريدها (من كل المصادر):</label>
            <div class="activities-list" aria-label="قائمة الأنشطة مع اختيار">
                <label v-for="(activity, idx) in allActivities" :key="idx" style="user-select:none;">
                    <input type="checkbox" :value="activity" v-model="selectedActivities" />
                    {{activity}}
                </label>
                <div v-if="selectedActivities.length < 15" style="color: #b03c3c; font-weight: 600; margin-top:8px;">
                    يرجى اختيار 15 نشاطًا على الأقل.
                </div>
            </div>
        </div>

        <div class="nav-buttons">
            <button @click="goPrevStep">&laquo; السابق</button>
            <button @click="goNextStep" :disabled="selectedActivities.length < 15">التالي &raquo;</button>
        </div>
    </section>

    <!-- Step 3: الجدارات -->
    <section v-show="step === 3" class="section" aria-label="توليد الجدارات والمهارات المرتبطة بالأنشطة">
        <div class="section-title">ثالثاً: توليد الجدارات والمهارات المرتبطة بالأنشطة المختارة</div>
        <p>لديك {{selectedActivities.length}} نشاط. لبدء توليد الجدارات لكل نشاط، استخدم الأزرار أدناه.</p>

        <div v-if="generatingCompetenciesActivity" style="color:#357edd; font-weight:600; margin-bottom:16px;">جارٍ توليد الجدارات والمهارات للنشاط "{{generatingCompetenciesActivity}}" ... <span class="loader"></span></div>

        <div v-for="(activity, idx) in selectedActivities" :key="activity" class="activity-block" >
            <div style="font-size: 1.1rem; font-weight: 700; margin-bottom: 8px;">{{idx+1}}. {{activity}}</div>
            <div class="inline-buttons">
                <button @click="generateCompetencies(activity, 'deepseek')" :disabled="isLoadingCompetency(activity, 'deepseek')">توليد الجدارات DEEPSEEK
                    <span v-if="isLoadingCompetency(activity, 'deepseek')" class="loader"></span>
                </button>
                <button @click="generateCompetencies(activity, 'gemini')" :disabled="isLoadingCompetency(activity, 'gemini')">توليد الجدارات GEMINI
                    <span v-if="isLoadingCompetency(activity, 'gemini')" class="loader"></span>
                </button>
                <button @click="clearCompetencies(activity)" style="background:#b03c3c;">مسح جدول الأنشطة</button>
            </div>

            <!-- Show Competencies -->
            <div v-if="competencies[activity]" style="margin-top:14px;">
                <div v-for="(competency, cidx) in competencies[activity]" :key="competency.name" class="competency-block" >
                    <div class="subsection-title">جدارة {{cidx + 1}}: {{competency.name}}</div>
                    <div class="inline-buttons" style="margin-bottom: 8px;">
                        <button @click="generateSkillsAndKnowledge(activity, competency.name, 'deepseek')" :disabled="isLoadingSkillKnowledge(activity, competency.name, 'deepseek')">توليد مهارات DEEPSEEK
                            <span v-if="isLoadingSkillKnowledge(activity, competency.name, 'deepseek')" class="loader"></span>
                        </button>
                        <button @click="generateSkillsAndKnowledge(activity, competency.name, 'gemini')" :disabled="isLoadingSkillKnowledge(activity, competency.name, 'gemini')">توليد مهارات GEMINI
                            <span v-if="isLoadingSkillKnowledge(activity, competency.name, 'gemini')" class="loader"></span>
                        </button>
                    </div>

                    <div style="display:flex; gap:14px; flex-wrap: wrap;">
                        <div style="flex: 1 1 45%;">
                            <label>المهارات العملية (افعال قابلة للقياس):</label>
                            <textarea readonly rows="5" :value="competency.skills ? competency.skills.join('\n- ') : ''"></textarea>
                        </div>
                        <div style="flex: 1 1 45%;">
                            <label>المعارف النظرية (مصطلحات غير قابلة للتحويل لأفعال):</label>
                            <textarea readonly rows="5" :value="competency.knowledge ? competency.knowledge.join('\n- ') : ''"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="nav-buttons" style="margin-top: 30px;">
            <button @click="goPrevStep">&laquo; السابق</button>
            <button @click="goNextStep" :disabled="!allCompetenciesGenerated">التالي &raquo;</button>
        </div>
    </section>

    <!-- Step 4: تجميع المحتويات الأساسية -->
    <section v-show="step === 4" class="section" aria-label="تجميع المحتويات الأساسية لإطار المنهج">
        <div class="section-title">رابعاً: تجميع محتويات الإطار العام للمنهج</div>
        <div>
            <label>اسم التخصص:</label>
            <div class="readonly-field">{{specializationName || 'لم يتم الإدخال بعد'}}</div>

            <label style="margin-top: 14px;">الوصف العام للمهنة:</label>
            <div class="readonly-field">{{confirmedDescription || 'لم يتم تحديد وصف'}}</div>

            <label style="margin-top: 14px;">الأنشطة الرئيسية المختارة:</label>
            <ul>
                <li v-for="(activity, idx) in selectedActivities" :key="activity"><b>{{idx+1}}.</b> {{activity}}</li>
            </ul>

            <div v-for="(activity, idx) in selectedActivities" :key="activity + '-comp'" style="margin-top: 20px;">
                <b>الجدارات المرتبطة بنشاط: {{activity}}</b>
                <div v-if="competencies[activity] && competencies[activity].length">
                    <div v-for="(competency, cidx) in competencies[activity]" :key="competency.name + '-comp-show'" class="competency-block" style="background:#e8f0fe;">
                        <div><b>جدارة {{cidx+1}}:</b> {{competency.name}}</div>
                        <ul>
                            <li><b>المهارات العملية:</b>
                                <ul>
                                    <li v-for="(skill,i) in competency.skills || []" :key="skill+i">{{skill}}</li>
                                </ul>
                            </li>
                            <li><b>المعارف النظرية:</b